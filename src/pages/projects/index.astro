---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import ProjectCard from '../../components/ProjectCard.astro';

// Get all projects, sorted by updatedAt/publishedAt, exclude drafts in production
const allProjects = await getCollection('projects', ({ data }) => {
  return import.meta.env.PROD ? !data.draft : true;
});

const sortedProjects = allProjects.sort((a, b) => {
  const dateA = a.data.updatedAt ?? a.data.publishedAt;
  const dateB = b.data.updatedAt ?? b.data.publishedAt;
  return dateB.getTime() - dateA.getTime();
});
---

<BaseLayout
  title="Projects"
  description="Explore my engineering projects - case studies on distributed systems, web applications, and ML infrastructure."
>
  <section class="py-12 md:py-16">
    <div class="container-wide">
      <div class="mx-auto max-w-3xl text-center">
        <h1 class="text-3xl font-bold tracking-tight text-gray-900 dark:text-white sm:text-4xl">
          Projects
        </h1>
        <p class="mt-4 text-lg text-gray-600 dark:text-gray-400">
          A collection of projects I've worked on. Each case study includes the problem, 
          approach, technical decisions, and lessons learned.
        </p>
      </div>

      <div class="mt-12 grid gap-6 md:grid-cols-2 lg:grid-cols-3">
        {sortedProjects.map((project) => (
          <ProjectCard project={project} />
        ))}
      </div>

      {sortedProjects.length === 0 && (
        <p class="mt-12 text-center text-gray-600 dark:text-gray-400">
          No projects yet. Check back soon!
        </p>
      )}
    </div>
  </section>
</BaseLayout>

